<Window x:Class="Lemoo.App.Views.Windows.LoginWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:vm="clr-namespace:Lemoo.App.ViewModels"
        xmlns:converters="clr-namespace:Lemoo.App.Helper.Converters"
        xmlns:toast="clr-namespace:Lemoo.App.Controls.Toast"
        mc:Ignorable="d"
        Title="登录"
        Height="600"
        Width="400"
        WindowStartupLocation="CenterScreen"
        WindowStyle="None"
        ResizeMode="NoResize"
        Background="#FF161A1E"
        ShowInTaskbar="True">
    <Window.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:PasswordVisibilityIconConverter x:Key="PasswordVisibilityIconConverter" />
    </Window.Resources>
    
    <Border BorderBrush="#FF2D2D30" BorderThickness="1" CornerRadius="12"
            MouseDown="WindowBorder_MouseDown"
            Background="#FF161A1E">
        <Border.Effect>
            <DropShadowEffect Color="Black"
                              Opacity="0.4"
                              BlurRadius="20"
                              ShadowDepth="8"
                              Direction="270" />
        </Border.Effect>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="32" />
                <RowDefinition Height="*" />
            </Grid.RowDefinitions>

            <!-- Toast 容器（显示在最上层） -->
            <Grid Grid.Row="0" Grid.RowSpan="2" 
                  HorizontalAlignment="Center" 
                  VerticalAlignment="Top"
                  Margin="0,10,0,0"
                  IsHitTestVisible="False"
                  Panel.ZIndex="1000">
                <ItemsControl x:Name="ToastContainer">
                    <ItemsControl.ItemsPanel>
                        <ItemsPanelTemplate>
                            <StackPanel Orientation="Vertical" />
                        </ItemsPanelTemplate>
                    </ItemsControl.ItemsPanel>
                </ItemsControl>
            </Grid>

            <!-- 标题栏：最小化和关闭按钮 -->
            <Grid Grid.Row="0" Background="Transparent">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>

                <!-- 可拖拽区域 -->
                <Border Grid.Column="0" 
                       MouseDown="TitleBar_MouseDown" 
                       Cursor="SizeAll"
                       Background="Transparent" />

                <!-- 窗口控制按钮 -->
                <StackPanel Grid.Column="1" Orientation="Horizontal" HorizontalAlignment="Right">
                    <!-- 最小化按钮 -->
                    <Button x:Name="MinimizeButton"
                           Click="MinimizeButton_Click"
                           Width="32"
                           Height="32"
                           Background="Transparent"
                           BorderThickness="0"
                           Cursor="Hand"
                           ToolTip="最小化">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Background" Value="Transparent" />
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="Border"
                                                   Background="{TemplateBinding Background}"
                                                   CornerRadius="6">
                                                <TextBlock Text="&#xE921;"
                                                          FontFamily="Segoe MDL2 Assets"
                                                          FontSize="12"
                                                          Foreground="#FFCCCCCC"
                                                          HorizontalAlignment="Center"
                                                          VerticalAlignment="Center" />
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Border" Property="Background" Value="#FF2D2D30" />
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                    </Button>

                    <!-- 关闭按钮 -->
                    <Button x:Name="CloseButton"
                           Click="CloseButton_Click"
                           Width="32"
                           Height="32"
                           Background="Transparent"
                           BorderThickness="0"
                           Cursor="Hand"
                           ToolTip="关闭">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Background" Value="Transparent" />
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="Border"
                                                   Background="{TemplateBinding Background}"
                                                   CornerRadius="6">
                                                <TextBlock x:Name="IconText"
                                                          Text="&#xE8BB;"
                                                          FontFamily="Segoe MDL2 Assets"
                                                          FontSize="12"
                                                          Foreground="#FFCCCCCC"
                                                          HorizontalAlignment="Center"
                                                          VerticalAlignment="Center" />
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Border" Property="Background" Value="#FFE81123" />
                                                    <Setter TargetName="IconText" Property="Foreground" Value="White" />
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                    </Button>
                </StackPanel>
            </Grid>

            <!-- 主内容区域 -->
            <Grid Grid.Row="1" Margin="30,15,30,25">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <!-- Logo 和标题 -->
                <StackPanel Grid.Row="0" HorizontalAlignment="Center" Margin="0,0,0,20">
                    <Image Source="pack://application:,,,/Assets/Images/Lemoo_move.png"
                          Width="100"
                          Height="100"
                          Stretch="Uniform"
                          Margin="0,0,0,15"
                          RenderOptions.BitmapScalingMode="HighQuality"
                          RenderOptions.CachingHint="Cache"
                          RenderOptions.ClearTypeHint="Enabled"
                          UseLayoutRounding="True"
                          SnapsToDevicePixels="True">
                        <Image.Effect>
                            <DropShadowEffect Color="Black"
                                              Opacity="0.3"
                                              BlurRadius="10"
                                              ShadowDepth="4"
                                              Direction="270"
                                              RenderingBias="Quality" />
                        </Image.Effect>
                    </Image>
                    <TextBlock Text="欢迎使用 Lemoo"
                              FontSize="26"
                              FontWeight="Bold"
                              Foreground="White"
                              HorizontalAlignment="Center">
                        <TextBlock.Effect>
                            <DropShadowEffect Color="Black"
                                              Opacity="0.2"
                                              BlurRadius="4"
                                              ShadowDepth="2"
                                              Direction="270" />
                        </TextBlock.Effect>
                    </TextBlock>
                </StackPanel>

                <!-- 登录表单 -->
                <StackPanel Grid.Row="1" VerticalAlignment="Top">
                    <TextBlock Text="用户名" 
                              Foreground="#FFCCCCCC" 
                              Margin="0,0,0,5" />
                    <TextBox x:Name="UsernameTextBox"
                        Text="{Binding Username, UpdateSourceTrigger=PropertyChanged}"
                        Padding="12,10"
                        Background="#FF2D2D30"
                        Foreground="White"
                        BorderBrush="#FF3F3F46"
                        BorderThickness="1"
                        Margin="0,0,0,20"
                        FontSize="14">
                    <TextBox.Style>
                        <Style TargetType="TextBox">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="TextBox">
                                        <Border x:Name="border"
                                               Background="{TemplateBinding Background}"
                                               BorderBrush="{TemplateBinding BorderBrush}"
                                               BorderThickness="{TemplateBinding BorderThickness}"
                                               CornerRadius="8">
                                            <ScrollViewer x:Name="PART_ContentHost"
                                                         Margin="{TemplateBinding Padding}" />
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="border" Property="BorderBrush" Value="#FF4A4A52" />
                                            </Trigger>
                                            <Trigger Property="IsFocused" Value="True">
                                                <Setter TargetName="border" Property="BorderBrush" Value="#FF0078D4" />
                                                <Setter TargetName="border" Property="BorderThickness" Value="2" />
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </TextBox.Style>
                    </TextBox>

                    <TextBlock Text="密码" 
                          Foreground="#FFCCCCCC" 
                          Margin="0,0,0,5" />
                    <!-- 密码输入容器（支持显示/隐藏切换） -->
                    <Grid Margin="0,0,0,20">
                    <!-- 隐藏密码输入框 -->
                    <PasswordBox x:Name="PasswordBox"
                                PasswordChanged="PasswordBox_PasswordChanged"
                                Padding="12,10,40,10"
                                Background="#FF2D2D30"
                                Foreground="White"
                                BorderBrush="#FF3F3F46"
                                BorderThickness="1"
                                FontSize="14"
                                Visibility="{Binding IsPasswordVisible, Converter={StaticResource BoolToVisibilityConverter}, ConverterParameter=Invert}">
                        <PasswordBox.Style>
                            <Style TargetType="PasswordBox">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="PasswordBox">
                                            <Border x:Name="border"
                                                   Background="{TemplateBinding Background}"
                                                   BorderBrush="{TemplateBinding BorderBrush}"
                                                   BorderThickness="{TemplateBinding BorderThickness}"
                                                   CornerRadius="8">
                                                <ScrollViewer x:Name="PART_ContentHost"
                                                             Margin="{TemplateBinding Padding}" />
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="border" Property="BorderBrush" Value="#FF4A4A52" />
                                                </Trigger>
                                                <Trigger Property="IsFocused" Value="True">
                                                    <Setter TargetName="border" Property="BorderBrush" Value="#FF0078D4" />
                                                    <Setter TargetName="border" Property="BorderThickness" Value="2" />
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </PasswordBox.Style>
                        </PasswordBox>
                    
                        <!-- 显示密码输入框 -->
                        <TextBox x:Name="PasswordTextBox"
                            TextChanged="PasswordTextBox_TextChanged"
                            Padding="12,10,40,10"
                            Background="#FF2D2D30"
                            Foreground="White"
                            BorderBrush="#FF3F3F46"
                            BorderThickness="1"
                            FontSize="14"
                            Visibility="{Binding IsPasswordVisible, Converter={StaticResource BoolToVisibilityConverter}}">
                        <TextBox.Style>
                            <Style TargetType="TextBox">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="TextBox">
                                            <Border x:Name="border"
                                                   Background="{TemplateBinding Background}"
                                                   BorderBrush="{TemplateBinding BorderBrush}"
                                                   BorderThickness="{TemplateBinding BorderThickness}"
                                                   CornerRadius="8">
                                                <ScrollViewer x:Name="PART_ContentHost"
                                                             Margin="{TemplateBinding Padding}" />
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="border" Property="BorderBrush" Value="#FF4A4A52" />
                                                </Trigger>
                                                <Trigger Property="IsFocused" Value="True">
                                                    <Setter TargetName="border" Property="BorderBrush" Value="#FF0078D4" />
                                                    <Setter TargetName="border" Property="BorderThickness" Value="2" />
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </TextBox.Style>
                        </TextBox>
                    
                        <!-- 显示/隐藏密码按钮 -->
                        <Button x:Name="TogglePasswordButton"
                           Command="{Binding TogglePasswordVisibilityCommand}"
                           Width="32"
                           Height="32"
                           HorizontalAlignment="Right"
                           VerticalAlignment="Center"
                           Margin="0,0,5,0"
                           Background="Transparent"
                           BorderThickness="0"
                           Cursor="Hand"
                           ToolTip="显示/隐藏密码">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Template">
                                    <Setter.Value>
                                        <ControlTemplate TargetType="Button">
                                            <Border x:Name="Border"
                                                   Background="Transparent"
                                                   CornerRadius="6"
                                                   Width="32"
                                                   Height="32">
                                                <ContentPresenter HorizontalAlignment="Center"
                                                                VerticalAlignment="Center" />
                                            </Border>
                                            <ControlTemplate.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter TargetName="Border" Property="Background" Value="#33FFFFFF" />
                                                </Trigger>
                                            </ControlTemplate.Triggers>
                                        </ControlTemplate>
                                    </Setter.Value>
                                </Setter>
                            </Style>
                        </Button.Style>
                        <TextBlock Text="{Binding IsPasswordVisible, Converter={StaticResource PasswordVisibilityIconConverter}}"
                                  FontFamily="Segoe MDL2 Assets"
                                  FontSize="16"
                                  Foreground="#FFCCCCCC"
                                  HorizontalAlignment="Center"
                                  VerticalAlignment="Center" />
                        </Button>
                    </Grid>

                    <!-- 记住密码复选框 -->
                    <CheckBox Content="记住密码"
                         IsChecked="{Binding RememberPassword}"
                         Foreground="#FFCCCCCC"
                         Margin="0,0,0,15"
                         FontSize="13"
                         VerticalContentAlignment="Center" />

                    <Button Content="登录"
                           Command="{Binding LoginCommand}"
                           IsDefault="True"
                           Padding="20,12"
                           Background="#FF0078D4"
                           Foreground="White"
                           BorderThickness="0"
                           FontSize="14"
                           FontWeight="SemiBold"
                           Cursor="Hand"
                           Margin="0,20,0,0">
                    <Button.Style>
                        <Style TargetType="Button">
                            <Setter Property="Template">
                                <Setter.Value>
                                    <ControlTemplate TargetType="Button">
                                        <Border x:Name="border"
                                               Background="{TemplateBinding Background}"
                                               CornerRadius="8"
                                               Padding="{TemplateBinding Padding}">
                                            <ContentPresenter HorizontalAlignment="Center"
                                                            VerticalAlignment="Center" />
                                        </Border>
                                        <ControlTemplate.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="#FF0085E5" />
                                                <Setter TargetName="border" Property="RenderTransform">
                                                    <Setter.Value>
                                                        <ScaleTransform ScaleX="1.02" ScaleY="1.02" />
                                                    </Setter.Value>
                                                </Setter>
                                                <Setter TargetName="border" Property="RenderTransformOrigin" Value="0.5,0.5" />
                                            </Trigger>
                                            <Trigger Property="IsPressed" Value="True">
                                                <Setter TargetName="border" Property="Background" Value="#FF0066B3" />
                                                <Setter TargetName="border" Property="RenderTransform">
                                                    <Setter.Value>
                                                        <ScaleTransform ScaleX="0.98" ScaleY="0.98" />
                                                    </Setter.Value>
                                                </Setter>
                                            </Trigger>
                                        </ControlTemplate.Triggers>
                                    </ControlTemplate>
                                </Setter.Value>
                            </Setter>
                        </Style>
                    </Button.Style>
                    </Button>
                </StackPanel>
            </Grid>
        </Grid>
    </Border>
</Window>

